/*! ukulelejs 2015-09-22 */
!function(){function a(a,c,g,h){for(var i=[b,d,e,f],j=0;j<i.length;j++){var k=i[j],l=k.apply(this,arguments);if(l)break}}function b(a,b,d,e){var f=a.tagName;return"INPUT"===f&&c(a)&&"value"===b?(a.addEventListener("change",function(c){var f=a.getAttribute("uku-"+b);f=p.getFinalAttribute(f);for(var g=f.split("."),h=d.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];h[g[g.length-1]]=a.value,e&&e(d.alias)}),!0):!1}function c(a){var b=a.getAttribute("type");return"checkbox"!==b&&"radio"!==b?!0:!1}function d(a,b,c,d){var e=a.tagName;return"SELECT"===e&&"selected"===b?(a.addEventListener("change",function(e){var f,g=a.getAttribute("uku-"+b),h=g.split("|");g=h[0],f=h[1],g=p.getFinalAttribute(g);for(var i=g.split("."),j=c.controllerInstance,k=0;k<i.length-1;k++)j=j[i[k]];for(var l=a.querySelectorAll("option"),m=0;m<l.length;m++){var n=l[m];if(n.selected){var o=JSON.parse(n.getAttribute("data-item"));j[i[i.length-1]]=o}}d&&d(c.alias)}),!0):!1}function e(a,b,c,d){var e=a.tagName;return"INPUT"===e&&"value"===b&&"checkbox"===a.getAttribute("type")?(a.addEventListener("change",function(e){var f=a.getAttribute("uku-"+b);f=p.getFinalAttribute(f);for(var g=f.split("."),h=c.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];h[g[g.length-1]]=a.checked,d&&d(c.alias)}),!0):!1}function f(a,b,c,d){var e=a.tagName;return"INPUT"===e&&"selected"===b&&"radio"===a.getAttribute("type")?(a.addEventListener("change",function(e){var f=a.getAttribute("uku-"+b);f=p.getFinalAttribute(f);for(var g=f.split("."),h=c.controllerInstance,i=0;i<g.length-1;i++)h=h[g[i]];a.checked&&(h[g[g.length-1]]=a.value,d&&d(c.alias))}),!0):!1}function g(){"use strict";function b(a){function b(a){var b=q[a];if(!b)return void(s.parentUku&&s.parentUku.refresh(a));for(var c=b.controllerInstance,e=r[a],f=0;f<b.boundItems.length;f++){var g=b.boundItems[f],h=g.attributeName;if(e){"selected"===g.ukuTag&&(h=h.split("|")[0]);var i=p.getFinalValue(s,c,h),j=p.getFinalValue(s,e,h);if(!o.compare(j,i)){h=g.attributeName;for(var k=b.getBoundItemsByName(h),l=0;l<k.length;l++){var m=k[l];m.render(c)}s.refreshHandler&&s.refreshHandler.call(s)}}}d(c,a)}if(a){if("string"==typeof a)b(a);else if(o.isArray(a))for(var c=0;c<a.length;c++)b(a[c])}else for(var e in q)b(e)}function c(){for(var a in q){var b=q[a],c=b.controllerInstance;d(c,a)}}function d(a,b){var c=o.deepClone(a);delete r[b],r[b]=c}function e(e){function k(a,b){function c(a){function e(a){var b=a.getAttribute("uku-onload");b&&g(b)}function f(a,b){var c=b.split("|");if(c&&2===c.length){var d=c[0],e=c[1];return a=a.replace(new RegExp(d,"gm"),e)}return a}var i=d[a],j=i.getAttribute("load");if("false"===j)a++,a<d.length?c(a):b();else{var l=i.getAttribute("src"),m=i.getAttribute("replace"),n=i.getAttribute("replace-controller"),o=new h;m&&"true"===m?!function(g){o.get(l,function(h){n&&(h=f(h,n)),g.insertAdjacentHTML("beforeBegin",h);var i=g.previousElementSibling;g.parentNode.removeChild(g),e(g),k(i,function(){a++,a<d.length?c(a):b()})})}(i):!function(g){o.get(l,function(h){n&&(h=f(h,n)),g.insertAdjacentHTML("afterBegin",h),g.classList.remove("uku-include"),e(g),k(g,function(){a++,a<d.length?c(a):b()})})}(i)}}var d=a.querySelectorAll(".uku-include"),e=0;e<d.length?c(e):b()}function n(a){-1!==p.searchUkuExpTag(i.directText(a))&&(p.isRepeat(a)||p.isInRepeat(a)||o(a));for(var b=0;b<a.children.length;b++)n(a.children[b])}function o(a){var b=i.directText(a);if(-1!==p.searchUkuExpTag(b)){var c=b.slice(2,-2),d=f(c);if(d){var e=new l(c,b,a,s);d.addBoundItem(e),e.render(d.controllerInstance)}}}function q(c,d){var e=c.getAttribute("uku-"+d),g=(c.tagName,e.split(".")[0],f(e));if(g){var h=new j(e,d,c,s);g.addBoundItem(h),h.render(g.controllerInstance),a(c,d,g,b)}}function r(a,c){var e=a.getAttribute("uku-"+c),h=c.substring(2),i=f(e);if(i){var j,k=i.controllerInstance,l=e.split(".");j="parent"===l[0]?l[1]:l[0],a.addEventListener(h,function(a){d(k,j),g(e,arguments),b(j)})}}function t(a){var b=a.getAttribute("uku-repeat"),c=b.split(" in "),d=c[0],e=c[1],g=f(e);if(g){var h=g.controllerInstance,i=new m(e,d,a,s);g.addBoundItem(i),i.render(h)}}k(e,function(){function a(a){for(var b=[],c=0;c<a.attributes.length;c++){var d=a.attributes[c];-1!==d.nodeName.search("uku-on")?b.push(d):b.unshift(d)}return b}var b=[],d=i.fuzzyFind(e,"uku-");d&&b.push(d);for(var f=e.querySelectorAll("*"),g=0;g<f.length;g++){var h=f[g],j=i.fuzzyFind(h,"uku-");j&&!p.isInRepeat(j)&&b.push(j)}n(e);for(var k=0;k<b.length;k++)for(var l=b[k],m=a(l),o=0;o<m.length;o++){var u=m[o];if(p.searchUkuAttrTag(u.nodeName)>-1){var v=u.nodeName.split("-");v.shift();var w=v.join("-");"application"!==w&&(0===w.search("on")?p.isRepeat(l)||p.isInRepeat(l)||r(l,w):-1!==w.search("repeat")?t(l):p.isRepeat(l)||p.isInRepeat(l)||q(l,w))}}s.refreshHandler&&s.refreshHandler.call(s),s.initHandler&&s.initHandler.call(s,e),c()})}function f(a){var b=p.getBoundModelInstantName(a),c=q[b];if(!c){var d=a.split("."),e=d[0];if("parent"===e&&s.parentUku)return d.shift(),a=d.join("."),s.parentUku.getControllerModelByName(a)}return c}function g(a,b){var c=f(a),d=c.controllerInstance,e=p.getFinalValue(s,d,a,b);return e}function k(){var a=document.querySelectorAll("[uku-application]");if(1!==a.length)throw new Error("Only one 'uku-application' can be declared in a whole html.");e(a[0])}var q={},r={},s=this;this.refreshHandler=null,this.initHandler=null,this.parentUku=null,this.init=function(){k()},this.registerController=function(a,b){var c=new n(a,b);q[a]=c},this.dealWithElement=function(a){e(a)},this.loadIncludeElement=function(a){"false"===a.getAttribute("load")&&(a.setAttribute("load",!0),e(a.parentNode))},this.getControllerModelByName=function(a){return f(a)},this.refresh=function(a){b(a)},this.getFinalValueByExpression=function(a){var b=this.getControllerModelByName(a).controllerInstance;return p.getFinalValue(this,b,a)}}function h(){}function i(){}function j(a,b,c,d){k.call(this,a,c,d),this.ukuTag=b}function k(a,b,c){"use strict";this.attributeName=a,this.element=b,this.uku=c}function l(a,b,c,d){k.call(this,a,c,d),this.expression=b}function m(a,b,c,d){k.call(this,a,c,d),this.expression=b,this.renderTemplate=c.outerHTML,this.parentElement=c.parentNode,this.beginCommentString=void 0,this.endCommentString=void 0}function n(a,b){"use strict";this.alias=a,this.controllerInstance=b,this.boundItems=[]}function o(){}function p(){"use strict"}"function"==typeof define&&define.amd?define("Ukulele",[],function(){return g}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports.Ukulele=g):window.Ukulele=g,h.prototype.get=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b(d.responseText):c&&c())},d.open("GET",a,!0),d.send(null)},i.fuzzyFind=function(a,b){if(a&&a.attributes)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];if(d.nodeName.search(b)>-1)return a}return null},i.directText=function(a,b){for(var c="",d=a.childNodes,e=0;e<=d.length-1;e++){var f=d[e];if(3===f.nodeType){if(b||""===b||0===b||b===!1)return void(f.nodeValue=b);c+=f.nodeValue}}return c.trim()},i.parents=function(a){for(var b=[];a.parentNode&&"BODY"!==a.parentNode.tagName;)b.push(a.parentNode),a=a.parentNode;return b},j.prototype=new k,j.prototype.constructor=j,j.prototype.render=function(a){var b,c=this.attributeName,d=this.element.tagName;if("selected"===this.ukuTag&&"SELECT"===d){var e=this.attributeName.split("|");c=e[0],b=e[1]}var f=p.getFinalValue(this.uku,a,c);if(-1!==this.ukuTag.search("data-item"))f=JSON.stringify(f),this.element.setAttribute("data-item",f);else if("selected"===this.ukuTag&&"SELECT"===d){var g;g=b?f[b]:f,this.element.value=g}else"checkbox"===this.element.getAttribute("type")?this.element.checked=f:"value"===this.ukuTag?this.element.value=f:"radio"===this.element.getAttribute("type")?this.element.value===f&&this.element.setAttribute("checked",!0):"IMG"===this.element.nodeName&&"src"===this.ukuTag?f?this.element.setAttribute(this.ukuTag,f):this.element.setAttribute(this.ukuTag,p.blankImg):this.element.setAttribute(this.ukuTag,f)},l.prototype=new k,l.prototype.constructor=l,l.prototype.render=function(a){var b=p.getFinalValue(this.uku,a,this.attributeName);i.directText(this.element,b)},m.prototype=new k,m.prototype.constructor=m,m.prototype.render=function(a){function b(a){return a.nodeValue===e.beginCommentString?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}function c(){var a=p.searchHtmlTag(e.renderTemplate,"tr");return-1===a?document.createElement("div"):document.createElement("tbody")}var d=p.getFinalValue(this.uku,a,this.attributeName);if(d){var e=this;if(this.element&&this.element.parentNode){this.beginCommentString="begin uku-repeat: "+this.expression+" in "+this.attributeName;var f=document.createComment(this.beginCommentString);this.element.parentNode.insertBefore(f,this.element),this.endCommentString="end uku-repeat: "+this.expression+" in "+this.attributeName;var h=document.createComment(this.endCommentString);this.element.parentNode.insertBefore(h,this.element.nextSibling),this.element.parentNode.removeChild(this.element)}for(var i=document.createTreeWalker(this.parentElement,NodeFilter.SHOW_COMMENT,b,!1);i.nextNode();){var j=i.currentNode;if(j&&j.nodeValue===this.beginCommentString){for(;j.nextSibling&&j.nextSibling.nodeValue!==this.endCommentString;)j.parentNode.removeChild(j.nextSibling);var k=c(),l=c();j.parentNode.insertBefore(l,j.nextSibling);for(var m=0;m<d.length;m++)if(k.insertAdjacentHTML("beforeEnd",this.renderTemplate),m===d.length-1){var n=k.innerHTML;l.insertAdjacentHTML("beforeBegin",n),j.parentNode.removeChild(l),k=null,l=null}for(var o=j.nextSibling,q=0;q<d.length;q++){o.removeAttribute("uku-repeat");var r=new g;r.parentUku=this.uku,r.registerController(this.expression,d[q]),r.dealWithElement(o),o=o.nextSibling}}}if("OPTION"===this.element.tagName){var s=this.parentElement.getAttribute("uku-selected"),t=s.split("|");s=t[0],key=t[1];var u=this.uku.getFinalValueByExpression(s);key?this.parentElement.value=u[key]:this.parentElement.value=u}}},n.prototype.addBoundItem=function(a){this.boundItems.push(a)},n.prototype.getBoundItemsByName=function(a){for(var b=[],c=0;c<this.boundItems.length;c++){var d=this.boundItems[c];d.attributeName===a&&b.push(d)}return b},o.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},o.getType=function(a){var b=typeof a;return"object"===b&&o.isArray(a)?"array":b},o.compare=function(a,b){var c=o.getType(a),d=o.getType(b),e=!0;if(c!==d)return!1;switch(c){case"object":for(var f in a){var g=a[f],h=b[f],i=o.compare(g,h);if(!i){e=!1;break}}break;case"array":if(a.length===b.length)for(var j=0;j<a.length;j++){var k=a[j],l=b[j],m=o.compare(k,l);if(!m){e=!1;break}}else e=!1;break;case"function":e=a.toString()===b.toString();break;default:e=a===b}return e},o.deepClone=function(a){var b,c,d;if("object"!=typeof a||null===a)return a;if(a instanceof Array)for(b=[],c=0,d=a.length;d>c;c++)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c];else{b={};for(c in a)"object"==typeof a[c]&&null!==a[c]?b[c]=arguments.callee(a[c]):b[c]=a[c]}return b},p.blankImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wkPAw8vVMDpsgAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAADElEQVQI12P4//8/AAX+Av7czFnnAAAAAElFTkSuQmCC",p.getFinalAttribute=function(a){var b=a.split("."),c=b.shift();return"parent"===c?p.getFinalAttribute(b.join(".")):b.join(".")},p.searchHtmlTag=function(a,b){var c="^<"+b+"\\s[\\s\\S]*</"+b+">$",d=new RegExp(c),e=a.search(d);return e},p.searchUkuAttrTag=function(a){var b=/^uku\-.*/,c=a.search(b);return c},p.searchUkuExpTag=function(a){var b=/^\{\{.*\}\}$/,c=a.search(b);return c},p.searchUkuFuncArg=function(a){var b=/\(.*\)$/,c=a.search(b);return c},p.isRepeat=function(a){return a.getAttribute("uku-repeat")?!0:!1},p.isInRepeat=function(a){for(var b=i.parents(a),c=0;c<b.length;c++){var d=b[c],e=d.getAttribute("uku-repeat");if(e)return!0}return!1},p.getBoundModelInstantName=function(a){var b=a.split(".")[0];return b?b:null},p.getAttributeFinalValue=function(a,b){var c=p.getAttributeFinalValueAndParent(a,b),d=c.value;return d},p.getAttributeFinalValueAndParent=function(a,b){var c,d=a;b=p.getFinalAttribute(b);var e=b.split(".");if(""!==b&&d)for(var f=0;f<e.length;f++){var g=e[f];if(c=d,d=d[g],void 0===d||null===d)break}return{value:d,parent:c}},p.getFinalValue=function(a,b,c,d){var e=p.searchUkuFuncArg(c);if(-1===e)return p.getAttributeFinalValue(b,c);var f=c.substring(0,e),g=p.getAttributeFinalValueAndParent(b,f),h=g.value;if(void 0===h)return h;var i=[],j=c.substring(e+1,c.length-1);if(""!==j){j=j.split(",");for(var k=0;k<j.length;k++){var l,m=j[k],n=a.getControllerModelByName(m);if(n&&n.controllerInstance){var o=n.controllerInstance;l=1===m.split(".").length?o:p.getFinalValue(a,o,m)}else l=p.getFinalValue(a,b,m);if(l!==b)i.push(l);else{var q=/\'.*\'/,r=m.search(q),s=/\".*\"/,t=m.search(s);-1!==r?(m=m.substring(1,m.length-1),i.push(m)):-1!==t?(m=m.substring(1,m.length-1),i.push(m)):i.push(l)}}}if(d){var u=Array.prototype.slice.call(d);i=i.concat(u)}return h=h.apply(g.parent,i)}}();